<?xml version="1.0" encoding="UTF-8"?>
<!--
  Copyright (c) 2012 Eclipse Foundation.
  All rights reserved. This program and the accompanying materials
  are made available under the terms of the Eclipse Distribution License v1.0
  which accompanies this distribution, and is available at
  http://www.eclipse.org/org/documents/edl-v10.php
 
  Contributors:
     Igor Fedorenko - initial implementation
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>eclipse.platform.releng.tychoeclipsebuilder</groupId>
    <artifactId>eclipse.platform.releng.tychoeclipsebuilder</artifactId>
    <version>4.3.0-SNAPSHOT</version>
  </parent>

  <artifactId>org.eclipse.platform.ide</artifactId>
  <version>4.3.0-SNAPSHOT</version>
  <packaging>eclipse-repository</packaging>

  <!--
  :pserver:anonymous@dev.eclipse.org:/cvsroot/eclipse

  R4_HEAD branch of  /org.eclipse.releng.eclipsebuilder/eclipse/buildConfigs/platform
   -->

  <build>
    <plugins>
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>target-platform-configuration</artifactId>
        <configuration>
            <includePackedArtifacts>false</includePackedArtifacts>
          <dependency-resolution>
            <extraRequirements>
              <!-- this guarantees proper reactor build order  -->
              <requirement>
                <type>eclipse-feature</type>
                <id>org.eclipse.rcp.configuration</id>
                <versionRange>0.0.0</versionRange>
              </requirement>
            </extraRequirements>
          </dependency-resolution>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-packaging-plugin</artifactId>
        <version>${tycho.version}</version>
        <configuration>
          <format>'${buildId}'</format>
        </configuration>
      </plugin>
        <plugin>
        <groupId>org.eclipse.tycho.extras</groupId>
        <artifactId>tycho-p2-extras-plugin</artifactId>
        <version>${tycho.version}</version>
        <executions>
          <execution>
            <id>mirror-build</id>
            <phase>prepare-package</phase>
            <goals>
              <goal>mirror</goal>
            </goals>
            <configuration>
              <source>
                <!-- Our "backdoor" way of getting rcp.config into repository, without defining rcp.cofnig feature in 'product' -->
                <!-- source repositories to mirror from -->
                <repository>
                  <url>${project.baseUri}/../eclipse.platform.releng.tychoeclipsebuilder/rcp.config/target/repository</url>
                  <layout>p2</layout>
                  <!-- supported layouts are "p2-metadata", "p2-artifacts", and "p2" (for joint repositories; default) -->
                </repository>

              </source>

              <!-- The destination directory to mirror to. -->
              <destination>${project.build.directory}/repository</destination>
              <!-- Whether only strict dependencies should be followed. -->
              <!-- "strict" means perfect version match -->
              <followStrictOnly>false</followStrictOnly>
              <!-- Whether or not to follow optional requirements. -->
              <includeOptional>false</includeOptional>
              <!-- Whether or not to follow non-greedy requirements. -->
              <includeNonGreedy>false</includeNonGreedy>
              <!-- Filter properties. E.g. filter only one platform -->
              <!-- Whether to filter the resulting set of IUs to only -->
              <!-- include the latest version of each IU -->
              <latestVersionOnly>true</latestVersionOnly>
              <!-- don't mirror artifacts, only metadata -->
              <mirrorMetadataOnly>false</mirrorMetadataOnly>
              <!-- whether to compress the content.xml/artifacts.xml -->
              <compress>true</compress>
              <!-- whether to append to the target repository content -->
              <append>true</append>
            </configuration>
          </execution>
       </plugin>
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-p2-director-plugin</artifactId>
        <executions>
          <execution>
            <id>materialize-products</id>
            <goals>
              <goal>materialize-products</goal>
            </goals>
            <configuration>
              <profile>SDKProfile</profile>
              <products>
                <product>
                  <id>org.eclipse.platform.ide</id>
                  <rootFolder>eclipse</rootFolder>
                </product>
              </products>
            </configuration>
          </execution>
          <execution>
            <id>archive-products</id>
            <goals>
              <goal>archive-products</goal>
            </goals>
            <configuration>
              <formats>
                <win32>zip</win32>
                <linux>tar.gz</linux>
                <macosx>tar.gz</macosx>
              </formats>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>

</project>
