<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta name="copyright" content="Copyright (c) IBM Corporation and others 2006, 2007. This page is made available under license. For full details see the LEGAL in the documentation book that contains this page." >
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="STYLESHEET" href="../../book.css" charset="ISO-8859-1" type="text/css">
<title>Incompatibilities between Eclipse 3.2 and 3.3</title>
</head>
<body>
<h1>Incompatibilities between Eclipse 3.2 and 3.3</h1>

<p> Eclipse changed in incompatible ways between 3.2 and 3.3 in ways that affect 
  plug-ins. The following entries describe the areas that changed and provide 
  instructions for migrating 3.2 plug-ins to 3.3. Note that you only need to look 
  here if you are experiencing problems running your 3.2 plug-in on 3.3.</p>
<p></p>
<ol>
  <li><a href="#launchConfigWorkingCopies">Nested Launch Configuration Working Copies</a></li>
  <li><a href="#FileEditorInput">Incompatible source change to getStorage() on FileEditorInput</a></li>
  <li><a href="#BootDelegation">Boot delegation changes</a></li>
  <li><a href="#LazyActivation">Lazy activation changes</a></li>
  <li><a href="#getEntryPaths">Clarification to Bundle.getEntryPaths</a></li>
  <li><a href="#HistoryView">History View didn't follow spec of IHistoryPageSource</a></li>
  <li><a href="#Proxy">Proxy settings are now managed by the platform</a></li>
  <li><a href="#startup.jar">Launching Eclipse with startup.jar</a></li>
  <li><a href="#DeviceResourceDescriptor">Incompatible source change to DeviceResourceDescriptor#createResource</a></li>
  <li><a href="#ResourceManager">Incompatible source change to ResourceManager resource creation methods</a></li>
   <li><a href="#jface-backcalls">JFace viewers and recursive back-calls</a></li>
   <li><a href="#IIDEActionConstants">IIDEActionConstants.FIND_EXT corrected to conform to specification</a></li>
   <li><a href="#IDEEncoding">IDEEncoding#setResourceEncoding deleted</a></li>
   <li><a href="#ErrorDialog">ErrorDialog client area has a potential extra column</a></li>
   <li><a href="#IIndexEntry">Binary incompatibility in IIndexEntry</a></li>
   <li><a href="#FormColors">Constant changed in FormColors</a></li>
</ol>
<hr>

<!-- ############################################## -->
<h2>1. <a name="launchConfigWorkingCopies">Nested Launch Configuration Working Copies</a></h2>
<p><strong>What is affected:</strong> Launch configuration working copies support 
  nesting in 3.3. Clients that programmatically create and save launch configurations 
  may be affected by the change in behavior of the <code>ILaunchConfigurationWorkingCopy.doSave() 
  </code> method. </p>
<p><strong>Description:</strong> When a working copy (B) is created from a working 
  copy (A) which was created from a launch configuration (X), the newly created 
  working copy (B) is initialized with the attributes from the first working copy 
  (A). In 3.3, whenever a working copy is saved, it is written back to the configuration 
  from which it was created. In this example working copy B will saves changes 
  back to working copy A, and A will save changes back to the original launch 
  configuration. A nested working copy has a parent working copy that can be retrieved 
  by calling <code>getParent()</code> (newly added in 3.3). In 3.2, working copies 
  were not nested and saving a working copy always resulted in the changes being 
  saved back to the original launch configuration.</p>
<p><strong>Action required:</strong> APIs are binary compatible but clients should 
  examine calls to <code>ILaunchConfiguration.getWorkingCopy()</code> and <code>ILaunchConfigurationWorkingCopy.doSave()</code> 
  to determine if nested working copies might be created. Note that saving a nested 
  working copy will not save changes back to the original launch configuration.</p>
<!-- ############################################## -->
<h2>2. <a name="FileEditorInput">Incompatible source change to getStorage() on FileEditorInput</a></h2>
<p><strong>What is affected:</strong> Clients that call getStorage() on FileEditorInput.</p>
<p><strong>Description:</strong> The signature of getStorage() was changed to
no longer throw a checked exception. This may cause compile errors in source code
previously compiled against Eclipse 3.2 that is recompiled against 3.3. This change
does not break binary compatibility - existing clients built against Eclipse 3.2 or
earlier will continue to function normally.</p>
<p><strong>Action required:</strong> Clients should recompile against Eclipse 3.3,
and remove any catch block that is now unnecessary due to the removed exception.</p>
<!-- ############################################## -->
<h2>3. <a name="BootDelegation">Boot delegation changes</a></h2>
<p><strong>What is affected:</strong> The boot delegation order has changed in 3.3.  Bundles that depend on delegating 
to the boot (parent) class loader first may be affected by this change.</p>
<p><strong>Description:</strong> In Eclipse 3.3 the default class loader delegation model has been changed to the following order:</p>
<ol>
<li>Imported packages (i.e. packages specified in the Import-Package manifest header).</li>
<li>Required bundles (i.e. bundles specified in the Require-Bundle manifest header).</li>
<li>Local bundle and fragments.</li>
<li>Boot (parent) class loader as a last resort.  This is only done if no source was found in the previous steps. </li>
</ol>
<p>In 3.2 the boot (parent) class loader is always delegated to first.  This provides no isolation from the 
classes provided by the VM.  It also affects performance because the boot class loader must be delegated to for every 
load even though it is known that the class or resource is located in a bundle.  Because of the boot delegation changes 
in 3.3, a bundle can now provide their own version of a package which is also available from the VM boot classpath.
See <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=162231"> bug 162231</a>.</p>

<p><strong>Action required:</strong> Bundles that export packages which may be available by the boot (parent) class loader 
need to evaluate whether the classes/resources they export should be added to the content from the boot class loader or replace it.
If the exporting bundle should replace the content of the boot class loader then no action is required.  If the exporting bundle should 
add to the content of the boot class loader then the exporting bundle should add &quot;system.bundle&quot; as a required bundle
(i.e. Require-Bundle: system.bundle).  To revert back to the behavior in 3.2 the configuration property 
&quot;org.osgi.framework.bootdelegation=*&quot; can be added to the config.ini file. </p>
<!-- ############################################## -->
<h2>4. <a name="LazyActivation">Lazy activation changes</a></h2>
<p><strong>What is affected:</strong> Bundles that use the lazy activation policy (i.e. &quot;Eclipse-LazyStart: true&quot;) 
will enter the Bundle.STARTING state as soon as they are eligible for lazy activation.  Clients that monitor the Bundle.STARTING 
state may be affected by this change.
</p>
<p><strong>Description:</strong> Eclipse 3.3 implements the OSGi R4.1 specification.  The OSGi R4.1 specification  
standardizes the lazy activation policy implemented in Eclipse.  Part of the standardization work changed the behavior of how 
bundles states are transitioned when a lazy activation policy is used.  When a bundle becomes available for lazy activation the bundle 
enters the Bundle.STATING state and a BundleEvent.LAZY_ACTIVATION event is fired.  This occurs before any class load 
request is made to the bundle.  The bundle will remain in the Bundle.STARTING state until the first class load is made and 
the bundle is activated.  When the bundle is activated a BundleEvent.STARTING event is fired and the BundleActivator.start method
is called.  See <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=135885">bug 135885</a>.
</p>
<p>
Bundles with a lazy activation policy could remain in the Bundle.STARTING state for a long time waiting for the first class load 
(trigger load) to occur.  Entering the Bundle.STARTING state does not mean the BundleActivator.start method has been called.  
The BundleActivator.start method is only called right after the BundleEvent.STARTING event is fired.  Bundles that monitor calls to 
BundleActivators must use a SynchronousBundleListener to listen for the BundleEvent.STARTING and BundleEvent.STOPPING 
events.
</p>
<p><strong>Action required:</strong> A SynchronousBundleListener must be used to monitor BundleEvent.STARTING and 
BundleEvent.STOPPING events for clients that are monitoring the calls to BundleActivators.</p>
<!-- ############################################## -->
<h2>5. <a name="getEntryPaths">Clarification to Bundle.getEntryPaths</a></h2>
<p><strong>What is affected:</strong> Clients of the Bundle.getEntryPaths method.
</p>
<p><strong>Description:</strong> The OSGi R4.1 specification has made a clarification on the behavior of the 
org.osgi.framework.Bundle#getEntryPaths method.  The javadoc for the method Bundle#getEntryPaths did not 
make it clear whether the String paths returned had a leading &quot;/&quot; character or not.  The following clarification has 
been made:</p> 
<p>
The returned paths are all relative to the root of this bundle and must not begin with &quot;/&quot;. 
</p>
Eclipse 3.2 had a bug for directory (non-jarred) bundles where a leading &quot;/&quot; character was included in the result if 
the client used a path argument that contained a leading &quot;/&quot;.  For jarred bundles Eclipse 3.2 always ensures 
the returned paths do not have a leading &quot;/&quot; character.  This is inconsistent behavior.  Directory bundles have  
been fixed to be consistent with jarred bundles.  See <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=174101"> bug 174101</a>.

<p><strong>Action required:</strong> Some clients may have a dependency on the old behavior for directory bundles.  If a client 
uses the method Bundle#getEntryPaths then ensure that it can handle returned paths that do not begin with a &quot;/&quot; character.
This dependency is a bug in the client code because it would have failed for jarred bundles.
</p>
<!-- ############################################## -->
<h2>6. <a name="HistoryView">History View didn't follow spec of IHistoryPageSource</a></h2>
<p><strong>What is affected:</strong> The History view may no longer show the history for certain elements.
</p>
<p><strong>Description:</strong> In 3.2, the History view did not follow the specification of IHistoryPageSource in 
the sense that, in some situations, it did not call canShowHistoryFor(Object) before requesting a history page. 
In 3.3, this was corrected which has lead to a situation where client code may have worked in 3.2 even though their implementation of
IHistoryPageSource did not follow the specification in the javadoc. 
</p>
<p><strong>Action required:</strong> Implementors of IHistoryPageSource need to ensure that their implementation follows
the specification defined in the javadoc of the interface.
</p>
<!-- ############################################## -->
<h2>7. <a name="Proxy">Proxy settings are now managed by the platform</a></h2>
<p><strong>What is affected:</strong> plug-ins in Eclipse that provided their own support for proxy specification 
(e.g HTTP, SSL or SOCKS).</p>
<p><strong>Description:</strong> A preference page and API was added in 3.3 to support the specification 
of HTTP, SSL and SOCKS proxies. Any tooling that provided their own support for this may conflict with the new
settings being managed by the Platform. The fix should be for tooling to remove their support for specifying
proxies and adopt the support provided by the Platform.
</p>
<!-- ############################################## -->
<h2>8. <a name="startup.jar">Launching Eclipse with startup.jar</a></h2>
<p><strong>What is affected:</strong> Eclipse can no longer be started
with <tt>java -jar startup.jar</tt>.<br>
</p>
<p><strong>Description:</strong> In 3.2, Eclipse was started using
startup.jar from the root of the Eclipse install. In 3.3, this jar is a
bundle in the plugins directory named org.eclipse.equinox.launcher. </p>
<p><strong>Action required:</strong> Change the command to <tt>java
-jar
plugins/org.eclipse.equinox.launcher_1.0.0.&lt;version&gt;.jar</tt> or
use
the eclipse launcher executable.
</p>
<!-- ############################################## -->
<h2>9. <a name="DeviceResourceDescriptor">Incompatible source change to DeviceResourceDescriptor#createResource</a></h2>
<p><strong>What is affected:</strong> Clients that call createResource(Device) on 
DeviceResourceDescriptor.</p>
<p><strong>Description:</strong> The DeviceResourceException thrown by JFace has been
changed to a runtime exception.  As part of this change, the method signature of 
createResource(Device) was changed to no longer throw the exception. This may cause 
compile errors in source code
previously compiled against Eclipse 3.2 that is recompiled against 3.3. This change
does not break binary compatibility - existing clients built against Eclipse 3.2 or
earlier will continue to function normally.</p>
<p><strong>Action required:</strong> Clients should recompile against Eclipse 3.3,
and remove any catch block that is now unnecessary due to the removed exception.</p>
<!-- ############################################## -->
<h2>10. <a name="ResourceManager">Incompatible source change to ResourceManager resource creation methods</a></h2>
<p><strong>What is affected:</strong> Clients that call resource creation methods on 
ResourceManager.</p>
<p><strong>Description:</strong> The DeviceResourceException thrown by JFace has been
changed to a runtime exception.  As part of this change, the following method signatures
were changed to no longer throw the exception. 
</p>
<ul>
<li>ResourceManager#create(DeviceResourceDescriptor)</li>
<li>ResourceManager#createColor(ColorDescriptor)</li>
<li>ResourceManager#createColor(RGB)</li>
<li>ResourceManager#createFont(FontDescriptor)</li>
<li>ResourceManager#createImage(ImageDescriptor)</li>
</ul>
<p>
These changes may cause compile errors in source code
previously compiled against Eclipse 3.2 that is recompiled against 3.3. This change
does not break binary compatibility - existing clients built against Eclipse 3.2 or
earlier will continue to function normally.</p>
<p><strong>Action required:</strong> Clients should recompile against Eclipse 3.3,
and remove any catch block that is now unnecessary due to the removed exception.</p>
<!-- ############################################## -->

<h2>11. <a name="jface-backcalls">JFace viewers and recursive back-calls</a></h2>
<p><strong>What is affected:</strong> Clients of <tt>TableViewer</tt> and <tt>TreeViewer</tt>, implementers of <tt>IStructuredContentProvider</tt> or <tt>IBaseLabelProvider</tt></p>
<p><strong>Description:</strong> <tt>StructuredViewer</tt> and its subclasses were never designed to handle
recursive back-calls to methods such as <tt>setInput()</tt>, <tt>refresh()</tt>, <tt>add()</tt>,
<tt>remove()</tt>, <tt>update()</tt> etc. In the past, calls to one of these update
methods that happened while the viewer was already in the process of
processing another update, lead to unpredictable behavior or even
runtime errors later on that were hard to debug. Starting with 3.3,
subclasses of ColumnViewer detect recursive back-calls, log an error and
ignore the nested update request. This helps uncover programming errors
such as spinning the event loop from a content provider or label
provider, but potentially changes the behavior in cases where clients
used recursive back-calls but didn't see immediate problems in the past in
their particular usage scenarios. See <a
	href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=154571">bug
154571</a> for details.</p>
<p><strong>Action required:</strong> No action required if you don't see
entries about ignored calls in the .log file. If you do see log entries,
the provided stack trace should have sufficient information to find the
problematic back-call. Depending on the situation, you might need to post
an asyncExec runnable to avoid the back-call.</p>
<!-- ############################################## -->
<h2>12. <a name="IIDEActionConstants"> IIDEActionConstants.FIND_EXT corrected to conform to specification</a></h2>
<p><strong>What is affected:</strong> Clients of <tt>IIDEActionConstants</tt> who use the values directly instead of via the constant.</p>
<p><strong>Description:</strong> Edit menu: name of group for extra Find-like actions (value <code>"find.ext"</code>).</p>
<p>The value of this constant has changed in 3.3 to match the specification; before 3.3, its value was incorrect (<code>"cut.ext"</code>).
See <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=155856">bug 155856</a> for details.</p>
<p><strong>Action required:</strong> No action required if you refer to the constant rather than its value.</p>
<!-- ############################################## -->
<h2>13. <a name="IDEEncoding">IDEEncoding#setResourceEncoding deleted</a></h2>
<p><strong>What is affected:</strong> Clients of <tt>IDEEncoding</tt>.</p>
<p><strong>Description:</strong> <code>IDEEncoding#setResourceEncoding</code> was deprecated in 3.2 (the same release it was 
added in) in favor of setting the ResourcesPlugin.PREF_ENCODING value
in the Resources plug-ins preference store. It was not deleted in the 3.2 release despite never having been valid API. 
It was deleted in the 3.3 release. </p>
<p><strong>Action required:</strong> Update references to <code>IDEEncoding#setEncoding</code> to calls to 
<code>ResourcesPlugin#getPlugin()#getPluginPreferences()#setValue(ResourcesPlugin.PREF_ENCODING,value)</code>.</p>
<!-- ############################################## -->
<h2>14. <a name="ErrorDialog">ErrorDialog client area has a potential extra column</a></h2>
<p><strong>What is affected:</strong> Subclasses of <tt>ErrorDialog</tt>.</p>
<p><strong>Description:</strong> <code>ErrorDialogs</code> will have an extra column in their client area
if there is an <code>ErrorSupportProvider</code> registered in an install. ErrorDialog subclasses that assume
there are 2 columns should call <code>IconAndMessageDialog#getColumnCount</code> instead.</p>
<p><strong>Action required:</strong> Update hard coded column counts to call to  <code>IconAndMessageDialog#getColumnCount</code> .</p>
<!-- ############################################## -->
<h2>15. <a name="IIndexEntry">Binary incompatibility in IIndexEntry</a></h2>
<p><strong>What is affected:</strong> Clients of IIndexEntry who rely on binary compatibility </tt>.</p>
<p><strong>Description:</strong> The return type of function getTopics() has changed from IHelpResource[] to the subclass ITopic[].
See <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=191224">bug 191224</a> for details.</p>
<p><strong>Action required:</strong> Source which uses this interface must be recompiled.</p>
<!-- ############################################## -->
<h2>16. <a name="FormColors">Constant changed in FormColors</a></h2>
<p><strong>What is affected:</strong> Clients of FormColors who rely on binary compatibility.</p>
<p><strong>Description:</strong> The value of the constant org.eclipse.ui.forms.FormColors.TB_GBG changed in Eclipse 3.3.
See <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=191233">bug 191233</a> for details.</p>
<p><strong>Action required:</strong> Update hard coded column counts to call to  <code>IconAndMessageDialog#getColumnCount</code> .</p>
<!-- ############################################## -->
</body>
</html>
